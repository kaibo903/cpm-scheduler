# 📚 使用者指南

## 目錄

1. [快速開始](#快速開始)
2. [功能說明](#功能說明)
3. [操作步驟](#操作步驟)
4. [範例專案](#範例專案)
5. [常見問題](#常見問題)
6. [技術說明](#技術說明)

---

## 快速開始

### 方式一：手動輸入

1. 在「工項名稱」欄位輸入工項名稱，例如：基礎開挖
2. 在「工期（天）」欄位輸入工期，例如：10
3. （可選）選擇前置作業或後續作業
4. 點擊「新增工項」按鈕
5. 重複步驟 1-4 直到所有工項都新增完成
6. 點擊「計算排程」按鈕查看結果

### 方式二：匯入 CSV

1. 點擊「下載範本」按鈕下載 CSV 範本
2. 使用 Excel 或文字編輯器編輯範本
3. 點擊「匯入 CSV」按鈕
4. 選擇您編輯好的 CSV 檔案
5. 系統會自動匯入並計算排程

---

## 功能說明

### 1. 工項輸入區

#### 欄位說明

- **工項名稱**（必填）
  - 工程或工作項目的名稱
  - 建議使用簡短明確的名稱
  - 範例：地質調查、結構設計、外牆裝修

- **工期（天）**（必填）
  - 該工項所需的工作天數
  - 必須為正整數
  - 範例：5、10、15

- **前置作業**（可選，支援多選）
  - 此工項開始前必須先完成的工項
  - 可以選擇多個前置作業
  - 點擊下方可用工項前的 + 按鈕來新增
  - 點擊已選工項上的 × 按鈕來移除
  - 不選代表起始工項

- **後續作業**（可選，支援多選）
  - 此工項完成後可以開始的工項
  - 可以選擇多個後續作業
  - 點擊下方可用工項前的 + 按鈕來新增
  - 點擊已選工項上的 × 按鈕來移除
  - 不選代表結束工項

#### 操作按鈕

- **新增工項**：將當前輸入的工項加入列表
- **刪除**：刪除某個已新增的工項
- **清空所有工項**：清除所有已新增的工項
- **計算排程**：執行 CPM 計算並顯示結果

### 2. CPM 計算結果

#### 專案總覽

- **專案總工期**：從開始到結束的總天數
- **關鍵工項數量**：關鍵路徑上的工項總數

#### 關鍵路徑

- 以紅色標示的工項序列
- 這些工項的延遲會直接影響專案總工期
- 箭頭顯示工項之間的依賴順序

#### 詳細計算結果表格

| 欄位 | 說明 | 計算公式 |
|------|------|----------|
| ES | 最早開始時間 | max(前置任務的EF) |
| EF | 最早完成時間 | ES + Duration |
| LS | 最晚開始時間 | LF - Duration |
| LF | 最晚完成時間 | min(後續任務的LS) |
| TF | 總浮時 | LS - ES |
| FF | 自由浮時 | min(後續任務的ES) - EF |

#### 標記說明

- **關鍵工項**：TF = 0 的工項，以紅色底色標示
- **起始**：沒有前置作業的工項
- **結束**：沒有後續作業的工項

### 3. 甘特圖

#### 圖表元素

- **時間軸**：顯示專案時程（Day 0, Day 1, ...）
- **工項名稱**：左側列出所有工項
- **任務條**：
  - 藍色：一般工項
  - 紅色：關鍵工項
  - 長度代表工期
- **依賴關係箭頭**：
  - 灰色：一般依賴
  - 紅色：關鍵路徑上的依賴

#### 互動功能

- **放大/縮小**：調整圖表顯示比例
- **重置**：恢復原始顯示比例
- **滑鼠懸停**：顯示工項詳細資訊
  - 工項名稱
  - 工期
  - ES/EF/LS/LF
  - 總浮時
  - 是否為關鍵工項

### 4. 匯入/匯出功能

#### 匯入 CSV

**檔案格式要求：**
```csv
工項名稱,工期(天),前置作業,後續作業
地質調查,5,,初步設計
初步設計,10,地質調查,結構設計
```

**注意事項：**
- 第一行必須是標題行
- 必填欄位：工項名稱、工期(天)
- 前置作業/後續作業可以為空
- 多個依賴關係用分號 `;` 或逗號 `,` 分隔
- 使用 UTF-8 編碼

#### 匯出工項

匯出當前的工項列表為 CSV 檔案，包含：
- 工項名稱
- 工期
- 前置作業
- 後續作業

#### 匯出結果

匯出 CPM 計算結果為 CSV 檔案，包含：
- 工項名稱
- 工期
- ES/EF/LS/LF
- TF/FF
- 是否為關鍵工項

#### 匯出報告

生成完整的關鍵路徑分析報告（TXT 格式），包含：
- 專案總工期
- 關鍵路徑序列
- 關鍵工項詳細資訊
- 其他工項浮時分析

---

## 操作步驟

### 情境 1：新建專案

1. 點擊「下載範本」取得 CSV 範本
2. 使用 Excel 編輯範本，輸入您的專案資料
3. 點擊「匯入 CSV」上傳檔案
4. 系統自動計算並顯示結果
5. 檢視 CPM 結果和甘特圖
6. 需要時匯出報告

### 情境 2：小型專案（< 10 個工項）

1. 直接在介面上手動輸入工項
2. 依序建立工項之間的依賴關係
3. 點擊「計算排程」
4. 查看結果並調整（如有需要）

### 情境 3：修改現有專案

1. 匯入原有的 CSV 檔案
2. 使用「刪除」按鈕移除不需要的工項
3. 手動新增新的工項
4. 重新計算排程
5. 匯出更新後的資料

---

## 範例專案

### 範例 1：簡單線性專案

**專案說明**：5 個工項，依序執行

| 工項名稱 | 工期 | 前置作業 |
|----------|------|----------|
| 地質調查 | 5 天 | - |
| 初步設計 | 10 天 | 地質調查 |
| 結構設計 | 15 天 | 初步設計 |
| 發包準備 | 7 天 | 結構設計 |
| 開工動員 | 3 天 | 發包準備 |

**結果**：
- 總工期：40 天
- 關鍵路徑：所有工項
- 所有工項 TF = 0

### 範例 2：有分支的專案

**專案說明**：設計階段有兩個平行工項

| 工項名稱 | 工期 | 前置作業 |
|----------|------|----------|
| 地質調查 | 5 天 | - |
| 初步設計 | 10 天 | 地質調查 |
| 結構設計 | 15 天 | 初步設計 |
| 機電設計 | 12 天 | 初步設計 |
| 施工圖審查 | 7 天 | 結構設計、機電設計 |

**結果**：
- 總工期：37 天
- 關鍵路徑：地質調查 → 初步設計 → 結構設計 → 施工圖審查
- 機電設計有 3 天浮時

### 範例 3：複雜營建專案

詳見專案根目錄的 `example.csv` 檔案，包含 14 個工項的完整營建專案。

---

## 常見問題

### Q1：什麼是關鍵路徑？

**A**：關鍵路徑是專案中最長的工項序列，決定了專案的總工期。關鍵路徑上的任何工項延遲都會導致整個專案延遲。

### Q2：什麼是浮時（Float）？

**A**：浮時是指某個工項可以延遲的天數，而不會影響後續工項或專案總工期。

- **總浮時（TF）**：可延遲而不影響專案總工期的天數
- **自由浮時（FF）**：可延遲而不影響後續工項的天數

### Q3：為什麼會出現「檢測到循環依賴」？

**A**：當工項之間形成循環依賴時會出現此錯誤，例如：
- A 的後續是 B
- B 的後續是 C
- C 的後續是 A（形成循環）

請檢查並修正依賴關係。

### Q4：如何決定工項的順序？

**A**：工項順序由依賴關係自動決定，您只需要指定：
- 哪些工項必須先完成（前置作業）
- 哪些工項可以接著做（後續作業）

系統會自動計算最優的排程順序。

### Q5：可以有多個起始工項嗎？

**A**：可以！沒有前置作業的工項都會被視為起始工項，它們可以同時開始。

### Q6：匯入 CSV 時出現錯誤怎麼辦？

**A**：請檢查：
1. 檔案格式是否正確（UTF-8 編碼）
2. 第一行是否為標題行
3. 工期是否為正整數
4. 依賴關係中的工項名稱是否正確

### Q7：如何理解甘特圖？

**A**：
- **橫軸**：時間（天數）
- **縱軸**：工項列表
- **藍色條**：一般工項的執行時段
- **紅色條**：關鍵工項的執行時段
- **箭頭**：工項之間的依賴關係

---

## 技術說明

### CPM 演算法

本系統採用標準的關鍵路徑法（Critical Path Method），主要步驟：

1. **拓樸排序**（Kahn's Algorithm）
   - 確保工項按正確順序處理
   - 檢測循環依賴

2. **Forward Pass（前向計算）**
   ```
   ES = max(前置任務的EF)
   EF = ES + Duration
   ```

3. **Backward Pass（後向計算）**
   ```
   LF = min(後續任務的LS)
   LS = LF - Duration
   ```

4. **浮時計算**
   ```
   TF = LS - ES
   FF = min(後續任務的ES) - EF
   ```

5. **關鍵路徑識別**
   - TF = 0 的工項為關鍵工項
   - 連接所有關鍵工項形成關鍵路徑

### 資料結構

**工項資料結構**：
```typescript
interface CPMTask {
  id: string              // 唯一識別碼
  name: string            // 工項名稱
  duration: number        // 工期（天數）
  predecessors: string[]  // 前置工項ID
  successors: string[]    // 後續工項ID
  es?: number            // 最早開始時間
  ef?: number            // 最早完成時間
  ls?: number            // 最晚開始時間
  lf?: number            // 最晚完成時間
  tf?: number            // 總浮時
  ff?: number            // 自由浮時
  isCritical?: boolean   // 是否為關鍵工項
}
```

### 效能限制

- 建議工項數量：< 50 個
- 最大工項數量：約 100 個（視瀏覽器效能而定）
- 關鍵路徑計算：< 1 秒
- 甘特圖渲染：< 2 秒

---

## 附錄

### 快捷鍵

- 在輸入框按 `Enter`：新增工項
- `Ctrl/Cmd + S`：（計劃中）儲存專案

### 瀏覽器相容性

- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+
- ❌ Internet Explorer（不支援）

### 檔案說明

- `example.csv`：複雜專案範例（14 個工項）
- `example_simple.csv`：簡單專案範例（5 個工項）
- `template.csv`：空白範本（可從系統下載）

---

如有任何問題或建議，請提出 Issue 或 Pull Request！

